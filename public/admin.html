<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proxy Admin Panel</title>
    <link rel="stylesheet" href="/style.css">
</head>

<body>
    <div class="container">
        <h1>Proxy Admin Panel</h1>
        <p>This host is linked to your browser only. Each browser can have a different proxy target configured.</p>
        <form id="update-form">
            <label for="targetHost">New proxy target:</label>
            <input type="url" id="targetHost" name="targetHost" placeholder="https://example.com" required>
            <button type="submit">Update</button>
        </form>
        <p id="status"></p>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", async () => {
            const status = document.getElementById("status");

            // Fetch and display the current proxy target from the cookie
            try {
                const response = await fetch('/current-target-host');
                if (response.ok) {
                    const data = await response.json();
                    status.textContent = `Current proxy target (linked to this browser): ${data.targetHost}`;
                    status.style.color = "blue";
                }
            } catch (error) {
                console.error("Failed to fetch current proxy target:", error);
            }

            // Handle form submission to update the proxy target
            document.getElementById('update-form').addEventListener('submit', async (e) => {
                e.preventDefault();
                const targetHost = document.getElementById('targetHost').value;

                try {
                    const updateResponse = await fetch('/current-target-host', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ targetHost }),
                    });

                    const updateResult = await updateResponse.json();
                    if (updateResponse.ok) {
                        status.textContent = `proxy target successfully updated to: ${updateResult.targetHost} (linked to this browser)`;
                        status.style.color = "green";
                    } else {
                        status.textContent = `Error: ${updateResult.message}`;
                        status.style.color = "red";
                    }
                } catch (error) {
                    status.textContent = `Failed to update proxy target: ${error.message}`;
                    status.style.color = "red";
                }
            });
        });
    </script>
</body>

</html>